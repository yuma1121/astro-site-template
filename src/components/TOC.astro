---

---

<nav class="toc-nav my-10" id="toc-container" aria-label="記事の目次">
  <div class="toc-header" id="toc-header-btn" role="button" tabindex="0" aria-expanded="true" aria-controls="toc-list">
    <span class="toc-label">目次</span>
    <span class="toc-toggle-text" id="toc-toggle-text">閉じる</span>
  </div>
  <ol class="toc-list" id="toc-list"></ol>
</nav>

<style>
  .toc-nav {
    border: 1px solid #dbeafe;
    border-radius: 0.5rem;
    background: #fff;
  }
  .toc-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #dbeafe;
    background: #f8faff;
    cursor: pointer;
    user-select: none;
  }
  .toc-label {
    font-size: 0.8125rem;
    font-weight: 700;
    color: #2563eb;
  }
  .toc-toggle-text {
    font-size: 0.75rem;
    color: #9ca3af;
  }
  .toc-list {
    list-style: none;
    padding: 0.625rem 1rem;
    margin: 0;
  }
  .toc-list.hidden {
    display: none;
  }
  .toc-list :global(.toc-h2) {
    padding: 0.375rem 0;
    font-size: 0.8125rem;
    color: #374151;
  }
  .toc-list :global(.toc-h2 a) {
    color: #374151;
    text-decoration: none;
  }
  .toc-list :global(.toc-h2 a:hover) {
    text-decoration: underline;
    text-underline-offset: 3px;
  }
  .toc-list :global(.toc-h3) {
    padding: 0.25rem 0 0.25rem 1rem;
    font-size: 0.75rem;
    color: #9ca3af;
  }
  .toc-list :global(.toc-h3 a) {
    color: #9ca3af;
    text-decoration: none;
  }
  .toc-list :global(.toc-h3 a:hover) {
    color: #374151;
  }
</style>

<script>
  function buildTOC() {
    const article = document.querySelector('article');
    const tocList = document.getElementById('toc-list');
    const tocContainer = document.getElementById('toc-container');

    if (!article || !tocList) return;

    const headings = article.querySelectorAll('#article-body h2, #article-body h3');

    if (headings.length === 0) {
      tocContainer?.classList.add('hidden');
      return;
    }

    headings.forEach((heading, index) => {
      if (!heading.id) {
        heading.id = `heading-${index}`;
      }

      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = `#${heading.id}`;
      a.textContent = heading.textContent;

      if (heading.tagName === 'H2') {
        li.className = 'toc-h2';
      } else {
        li.className = 'toc-h3';
      }

      li.appendChild(a);
      tocList.appendChild(li);
    });

    const headerBtn = document.getElementById('toc-header-btn');
    const toggleText = document.getElementById('toc-toggle-text');

    headerBtn?.addEventListener('click', () => {
      const isExpanded = headerBtn.getAttribute('aria-expanded') === 'true';
      headerBtn.setAttribute('aria-expanded', String(!isExpanded));
      tocList.classList.toggle('hidden');
      if (toggleText) toggleText.textContent = isExpanded ? '開く' : '閉じる';
    });

    headerBtn?.addEventListener('keydown', (e: KeyboardEvent) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        headerBtn.click();
      }
    });
  }

  buildTOC();
</script>
