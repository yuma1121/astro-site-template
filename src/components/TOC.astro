---

---

<nav class="toc-nav my-10" id="toc-container" aria-label="記事の目次">
  <button class="toc-header" id="toc-header-btn" aria-expanded="true" aria-controls="toc-list">
    <div class="toc-header-left">
      <svg class="toc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="8" y1="6" x2="21" y2="6" /><line x1="8" y1="12" x2="21" y2="12" /><line x1="8" y1="18" x2="21" y2="18" />
        <line x1="3" y1="6" x2="3.01" y2="6" /><line x1="3" y1="12" x2="3.01" y2="12" /><line x1="3" y1="18" x2="3.01" y2="18" />
      </svg>
      <span class="toc-label">目次</span>
    </div>
    <svg class="toc-chevron" id="toc-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="6 9 12 15 18 9" />
    </svg>
  </button>
  <div class="toc-body" id="toc-body">
    <ol class="toc-list" id="toc-list"></ol>
  </div>
</nav>

<style>
  .toc-nav {
    border: 1px solid #e5e7eb;
    border-radius: 0.75rem;
    background: #fff;
    overflow: hidden;
  }

  .toc-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 0.875rem 1rem;
    background: #f9fafb;
    border: none;
    border-bottom: 1px solid #e5e7eb;
    cursor: pointer;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }

  .toc-header:active {
    background: #f3f4f6;
  }

  .toc-header-left {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .toc-icon {
    width: 1rem;
    height: 1rem;
    color: #6b7280;
    flex-shrink: 0;
  }

  .toc-label {
    font-size: 0.8125rem;
    font-weight: 700;
    color: #374151;
    letter-spacing: 0.025em;
  }

  .toc-chevron {
    width: 1rem;
    height: 1rem;
    color: #9ca3af;
    transition: transform 0.25s ease;
    flex-shrink: 0;
  }

  .toc-chevron.collapsed {
    transform: rotate(-180deg);
  }

  .toc-body {
    overflow: hidden;
    transition: max-height 0.3s ease, opacity 0.25s ease;
    max-height: 60rem;
    opacity: 1;
  }

  .toc-body.collapsed {
    max-height: 0;
    opacity: 0;
  }

  .toc-list {
    list-style: none;
    padding: 0.5rem 0;
    margin: 0;
    counter-reset: toc-counter;
  }

  .toc-list :global(.toc-h2) {
    counter-increment: toc-counter;
    position: relative;
  }

  .toc-list :global(.toc-h2 a) {
    display: flex;
    align-items: baseline;
    gap: 0.625rem;
    padding: 0.5rem 1rem;
    font-size: 0.8125rem;
    font-weight: 500;
    color: #374151;
    text-decoration: none;
    transition: background 0.15s, color 0.15s;
    border-left: 2px solid transparent;
  }

  .toc-list :global(.toc-h2 a::before) {
    content: counter(toc-counter) ".";
    font-size: 0.75rem;
    font-weight: 700;
    color: #2563eb;
    flex-shrink: 0;
    min-width: 1.25rem;
  }

  .toc-list :global(.toc-h2 a:hover) {
    background: #f3f4f6;
    color: #111827;
    border-left-color: #2563eb;
  }

  .toc-list :global(.toc-h3 a) {
    display: block;
    padding: 0.3125rem 1rem 0.3125rem 3.125rem;
    font-size: 0.75rem;
    color: #9ca3af;
    text-decoration: none;
    transition: color 0.15s;
  }

  .toc-list :global(.toc-h3 a:hover) {
    color: #6b7280;
  }

  @media (max-width: 1023px) {
    .toc-list :global(.toc-h2 a::before) {
      display: none;
    }
    .toc-list :global(.toc-h2 a) {
      gap: 0;
    }
    .toc-list :global(.toc-h3 a) {
      padding-left: 1.75rem;
    }
  }
</style>

<script>
  function buildTOC() {
    const article = document.querySelector('article');
    const tocList = document.getElementById('toc-list');
    const tocContainer = document.getElementById('toc-container');

    if (!article || !tocList) return;

    const headings = article.querySelectorAll('#article-body h2, #article-body h3');

    if (headings.length === 0) {
      tocContainer?.classList.add('hidden');
      return;
    }

    headings.forEach((heading, index) => {
      if (!heading.id) {
        heading.id = `heading-${index}`;
      }

      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = `#${heading.id}`;
      a.textContent = heading.textContent;

      if (heading.tagName === 'H2') {
        li.className = 'toc-h2';
      } else {
        li.className = 'toc-h3';
      }

      li.appendChild(a);
      tocList.appendChild(li);
    });

    const headerBtn = document.getElementById('toc-header-btn');
    const chevron = document.getElementById('toc-chevron');
    const tocBody = document.getElementById('toc-body');

    headerBtn?.addEventListener('click', () => {
      const isExpanded = headerBtn.getAttribute('aria-expanded') === 'true';
      headerBtn.setAttribute('aria-expanded', String(!isExpanded));
      tocBody?.classList.toggle('collapsed');
      chevron?.classList.toggle('collapsed');
    });
  }

  buildTOC();
</script>
